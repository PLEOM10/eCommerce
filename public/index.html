<!DOCTYPE html>

<html>
<style>
    body {
        font-family: Arial, Helvetica, sans-serif;
    }
    
    * {
        box-sizing: border-box;
    }
    
    input[type=text],
    input[type=number] {
        width: 100%;
        padding: 15px;
        margin: 5px 0 22px 0;
        display: inline-block;
        border: none;
        background: #f1f1f1;
    }
    
    input[type=password] {
        width: 100%;
        padding: 15px;
        margin: 5px 0 0px 0;
        display: inline-block;
        border: none;
        background: #f1f1f1;
    }
    
    input[type=text]:focus,
    input[type=number],
    input[type=password]:focus {
        background-color: #ddd;
        outline: none;
    }
    
    button {
        background-color: black;
        color: rgb(76, 253, 244);
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        cursor: pointer;
        width: 100%;
        opacity: 0.9;
        border-radius: 5px;
        padding: 1%;
        transition: transform 250ms;
    }
    
    button:hover {
        opacity: 1;
        transform: translateY(2px);
    }
    
    .cancelbtn {
        padding: 14px 20px;
        background-color: #f74f0d;
        color: black;
        padding: 1%;
    }
    
    .cancelbtn,
    .signupbtn {
        float: left;
        width: 49%;
        margin: 2px;
    }
    
    .container {
        padding: 16px;
    }
    
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: #474e5d;
        padding-top: 50px;
    }
    
    .modal-content {
        background-color: #fefefe;
        margin: 5% auto 15% auto;
        border: 1px solid #888;
        width: 40%;
    }
    
    hr {
        border: 1px solid #f1f1f1;
        margin-bottom: 25px;
    }
    
    .close {
        position: sticky;
        right: 35px;
        top: 10px;
        font-size: 40px;
        font-weight: bold;
        color: black;
        float: right;
    }
    
    .close:hover,
    .close:focus {
        color: #f44336;
        cursor: pointer;
    }
    
    .clearfix::after {
        content: "";
        clear: both;
        display: table;
    }
    
    #bg_img {
        background-image: url(images/bg_img_index.jpg);
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-color: RGB(251 233 13);
    }
    
    #card1 {
        background-color: #fefefe;
        width: 28%;
        text-align: center;
        border-radius: 20px;
        margin-top: 19.3%;
        margin-left: 50%;
        position: inherit;
    }
</style>

<body style="background-color:rgb(255, 0, 0);border: 5px solid rgb(253, 112, 18);">
    <div id="bg_img">
        <div style="width:100%;padding: 10px;"></div>
        <div id="card1" style="background-image: url(images/bg_img.jpg);">
            <div style="backdrop-filter: blur(10px);height: max-content;border-radius: 20px;border:2px solid white ">
                <br>
                <h2 style="width:auto;color: rgb(2, 255, 242); text-shadow: -3px 5px 0 rgba(0, 0, 0, 0.4);padding-top: 10px;margin-top: 0px;">Enter the E-Commerce Portal</h2>
                <button onclick="document.getElementById('id01').style.display='block'" style="width:auto; padding: 4%;border:2px white solid;font-size: large;font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;border-radius: 20px;"><b>Sign Up</b></button>
                <a style="color:rgb(0, 255, 255)"> &Rightarrow;</a>
                <button onclick="document.getElementById('id02').style.display='block'" style="width:auto; padding: 4%;border:2px white solid;font-size: large;font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;border-radius: 20px;"><b>Login</b></button>
                <br><br>
            </div>
        </div>
        <div style="width:100%;padding-bottom: 11%;"></div>
    </div>

    <div id="id01" class="modal" style="background-color: transparent;backdrop-filter: blur(10px);">
        <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close Modal">&times;</span>
        <form class="modal-content">
            <div class="container">
                <h1>Sign Up</h1>
                <p>Please fill in this form to create an account.</p>
                <hr>
                <label for="usr"><b>Username</b></label>
                <input type="text" placeholder="Enter Username" id="s_usrnm" name="username" required>

                <label for="psw"><b>Password</b></label>
                <input type="password" placeholder="Enter Password" id="s_pswd" name="password" list="programmingLanguages" onchange="generatePassword()" required>
                <p id="sugg" style="font-size:12px;margin-top: 5px;margin-bottom: 15px;"><br></p>

                <label for="fname"><b>First Name</b></label>
                <input type="text" placeholder="Enter your First Name" id="s_fname" name="first_name" required>

                <label for="lname"><b>Last Name</b></label>
                <input type="text" placeholder="Enter your Last Name" id="s_lname" name="last_name" required>

                <label for="tlphn"><b>Telephone</b></label>
                <input type="number" placeholder="Enter your Telephone" id="s_num" name="telephone" required>

                <label for="tlphn"><b>Email</b></label>
                <input type="text" placeholder="Enter your Email" id="s_email" name="email" required>

                <p>By creating an account you agree to our <a href="#" style="color:dodgerblue">Terms & Privacy</a>.</p>
                <div class="clearfix">
                    <button type="button" onclick="document.getElementById('id01').style.display='none'" class="cancelbtn">Cancel</button>
                    <button class="signupbtn" id="signup">Sign Up</button>
                </div>
            </div>
        </form>
    </div>
    <div id="id02" class="modal" style="background-color: transparent;backdrop-filter: blur(10px);">
        <span onclick="document.getElementById('id02').style.display='none'" class="close" title="Close Modal">&times;</span>
        <form class="modal-content">
            <div class="container">
                <h1>Login</h1>
                <p>Enter login credentials</p>
                <hr>
                <label for="usr"><b>Username</b></label>
                <input type="text" placeholder="Enter Email" name="username" id="usrnm" required>

                <label for="psw"><b>Password</b></label>
                <input type="password" placeholder="Enter Password" id="pswd" name="password" required>
                <br><br>
                <div class="clearfix">
                    <button type="button" onclick="document.getElementById('id02').style.display='none'" class="cancelbtn">Cancel</button>
                    <button class="signupbtn" id="login">Login</button>
                </div>
            </div>
        </form>
    </div>
    <script>
        async function main() {
            sessionStorage.removeItem('token')
        }

        var modal = document.getElementById('id01 ');
        var modal1 = document.getElementById('id02');
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
            if (event.target == modal1) {
                modal1.style.display = "none"
            }
        }

        async function generatePassword() {
            var length = Math.floor(Math.random() * 9) + 10
            const lower = "abcdefghijklmnopqrstuvwxyz"
            const upper = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
            const number = "0123456789"
            const special = "!#$%&()*+,-./:;<=>?@[\]^_`}|{~"
            const allChar = upper + special + number + lower
            let password = "";
            let arr = [upper[Math.floor(Math.random() * upper.length)], special[Math.floor(Math.random() * special.length)], lower[Math.floor(Math.random() * lower.length)], number[Math.floor(Math.random() * number.length)]]
            for (var i = arr.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = arr[i];
                arr[i] = arr[j];
                arr[j] = temp;
            }
            password += arr[0] + arr[1] + arr[2] + arr[3]
            while (length > password.length) {
                password += allChar[Math.floor(Math.random() * allChar.length)]
            }
            document.getElementById('sugg').innerHTML = `Suggested Password : ${password}`;
        }

        document.getElementById('login').onclick = async function(e) {
            e.preventDefault();
            let result = await fetch("/logIn", {
                method: 'POST',
                headers: {
                    "Content-type": "application/json"
                },
                body: JSON.stringify({
                    username: document.getElementById('usrnm').value,
                    password: document.getElementById('pswd').value
                })
            });
            let resData = await result.json();
            console.log(resData.data);

            if (resData.status == 200) {
                alert(resData.data.user_type + " " + resData.message);
                if (resData.data.user_type == "CUSTOMER") {
                    sessionStorage.setItem('token', resData.data.token);
                    sessionStorage.setItem('id', resData.data.id)
                    location.href = "http://localhost:3000/products";
                } else {
                    sessionStorage.setItem('token', resData.data.token);
                    location.href = "http://localhost:3000/admin";
                }

            } else {
                alert(resData.error.message)
            }
        }

        document.getElementById('signup').onclick = async function(e) {
            e.preventDefault();
            let result = await fetch("/signUp", {
                method: 'POST',
                headers: {
                    "Content-type": "application/json"
                },
                body: JSON.stringify({
                    username: document.getElementById('s_usrnm').value,
                    password: document.getElementById('s_pswd').value,
                    first_name: document.getElementById('s_fname').value,
                    last_name: document.getElementById('s_lname').value,
                    telephone: document.getElementById('s_num').value,
                    email: document.getElementById('s_email').value,
                })
            });
            let resData = await result.json();

            if (resData.status == 201) {
                alert(resData.message);
            } else if (resData.status == 500) {
                alert(resData.message)
            } else {
                alert(resData.error.message)
            }
        }

        main()
    </script>

</body>

</html>